{% extends 'base.html' %}

{% block content %}
<div class="ocf-content-block" style="margin-bottom: 50px;">
    {% include 'webprint/components/webprint-new.html' %}

    <p>
        Welcome to the OCF's Web Printing Service! Once you've printed your document, you can click on your print request to view the print code.
    </p>
    <p style="font-weight: bold;">IMPORTANT:</p>
    <ul>
        <li>You must <u>display the QR code at the camera in the front of the lab</u> to print your document.</li>
        <li>Print requests expire <u>in 24 hours</u>.</li>
    </ul>
    <a class="btn btn-lg btn-primary" style="margin-top: 10px;" href="{% url 'webprint-new-request' %}">Print a Document</a>
    <h3 style="margin-top: 40px; margin-bottom: 10px;">Print Quota</h3>
    <p>You have <u>{{remaining_pages_day}} pages remaining</u> for today.</p>
    <p>You have <u>{{remaining_pages_semester}} pages remaining</u> for this semester.</p>
    <h3 style="margin-top: 40px;">Print Requests</h3>
    {% if pending_requests %}
        <table style="margin-top: 10px;">
            <thead>
                <tr>
                    <th style="width: 10%;" class="table-header-cell">Printed?</th>
                    <th style="width: 20%;" class="table-header-cell">Document</th>
                    <th style="width: 10%;" class="table-header-cell">Pages</th>
                    <th style="width: 10%;" class="table-header-cell">Expires</th>
                    <th style="width: 20%;" class="table-header-cell">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for request in pending_requests %}
                    <tr>
                        <td class="table-cell">
                            {% if request.printed %}
                                <span class="glyphicon glyphicon-ok" style="color: green;"></span>
                            {% else %}
                                <span class="glyphicon glyphicon-remove" style="color: #aaa;"></span>
                            {% endif %}
                        </td>
                        <td class="table-cell">
                            {{request.document}}
                        </td>
                        <td class="table-cell">
                            {{request.pages}}
                        </td>
                        <td class="table-cell">
                            {{request.expiry}}
                        </td>
                        <td class="table-cell">
                            {% if not request.printed %}
                                <a class="btn btn-sm btn-primary"
                                   href="{% url 'webprint-view-code' %}?request_id={{ request.id }}"
                                   style="margin-right: 3px; margin-bottom: 1px;"
                                >View Code</a>
                                <button class="btn btn-sm btn-danger"
                                        onclick="cancelPrintRequest({{ request.id }})"
                                        style="margin-bottom: 1px;"
                                >Cancel</button>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-muted">No pending print requests. When you create a print request, it will appear here.</p>
    {% endif %}
</div>

<style>
    .table-header-cell {
        padding: 4px;
        font-weight: bold;
    }
    .table-cell {
        text-overflow: ellipsis;
        padding: 6px 4px;
    }
    .pending-jobs {
        margin-top: 20px;
    }
</style>
{% endblock %}
